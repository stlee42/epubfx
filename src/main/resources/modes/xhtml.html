<!doctype html>
<html>
<head>
    <link rel="stylesheet" href="http://localhost:8777/codemirror-4.4/lib/codemirror.css">
    <script src="http://localhost:8777/codemirror-4.4/lib/codemirror.js"></script>
    <script src="http://localhost:8777/codemirror-4.4/mode/xml/xml.js"></script>
    <script src="http://localhost:8777/codemirror-4.4/addon/edit/closebrackets.js"></script>
    <script src="http://localhost:8777/codemirror-4.4/addon/edit/closetag.js"></script>
    <script src="http://localhost:8777/codemirror-4.4/addon/fold/xml-fold.js"></script>
    <script src="http://localhost:8777/codemirror-4.4/addon/edit/matchbrackets.js"></script>
    <script src="https://raw.githubusercontent.com/cfinke/Typo.js/master/typo/typo.js"></script>

    <style type="text/css">
        .CodeMirror
        {
            border: 1px solid green;
            font-family: "Source Code Pro", Consolas;
            font-size: 14px;
            height:auto;
        }
        .CodeMirror-scroll {
            overflow-y: hidden;
            overflow-x: auto;
        }
        .CodeMirror .cm-spell-error
        {
            background: url("https://raw.githubusercontent.com/jwulf/typojs-project/master/public/images/red-wavy-underline.gif") bottom repeat-x;
        }
    </style>
</head>
<body>
<form><textarea id="code" name="code"></textarea></form>
<script>
    var typo = new Typo ("de_DE", null, null, {
        platform: 'any'
    });
    var affData = typo._readFile("http://localhost:8777/codemirror-4.4/dict/de_DE.aff", "ISO-8859-1");
    var wordData = typo._readFile("http://localhost:8777/codemirror-4.4/dict/de_DE.dic", "ISO-8859-1");

    CodeMirror.defineMode("spell-check", function(config, parserConfig) {
        var rx_word = new RegExp("[^\!\"\#\$\%\&\(\)\*\+\,\-\.\/\:\;\<\=\>\?\@\[\\\]\^\_\`\{\|\}\~\ ]");
        var spellOverlay = {
            token: function (stream, state) {
                var ch;
                if (stream.match(rx_word)) {
                    while ((ch = stream.peek()) != null) {
                        if (!ch.match(rx_word)) {
                            break;
                        }
                        stream.next();
                    }
                    if (!typo.check(stream.current()))
                        return "spell-error";
                    return null;
                }
                while (stream.next() != null && !stream.match(rx_word, false)) {}
                return null;
            }
        };

        return CodeMirror.overlayMode(CodeMirror.getMode(config, parserConfig.backdrop || "text/html"), spellOverlay);
    });

    var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        lineNumbers: true,
        matchBrackets: true,
        indentUnit: 2,
        lineWrapping:true,
        viewportMargin:Infinity,
        maxHighlightLength:Infinity,
        autoCloseBrackets: true,
        autoCloseTags: true,
        smartIndent:false,
        mode: {name: "xml", htmlMode: false}
    });
</script>
</body>
</html>